VBA

Option Explicit

'-- holds our connection to CANoe
Dim canoeApp As CANoe.Application
Dim resetFn  As CANoe.CAPLFunction

Sub StartCANoe()
    ' 1) Launch or attach to CANoe
    Set canoeApp = CreateObject("CANoe.Application")
    
    ' 2) Open your config (update the path)
    canoeApp.Open "C:\Projects\MyTest\MyConfig.cfg"
    
    ' 3) Compile CAPL (good practice) & start measurement
    canoeApp.CAPL.Compile
    canoeApp.Measurement.Start
    
    ' 4) Grab the ResetCounter CAPL function (must do this in OnInit
    '    – here we cheat by just calling it once after the Start)
    Set resetFn = canoeApp.CAPL.GetFunction("ResetCounter")
End Sub

Sub LogAndReset()
    Dim prev As Long
    Dim vars As CANoe.Variables
    
    ' 1) Read the System Variable General.PreviousReading
    Set vars = canoeApp.System.Namespaces("General").Variables
    prev = vars("PreviousReading").Value
    
    ' 2) Append it in Excel
    With ThisWorkbook.Sheets("TestData")
      .Cells(.Rows.Count, 1).End(xlUp).Offset(1, 0).Value = prev
    End With
    
    ' 3) Now call into CAPL to reset the counter
    resetFn.Call
End Sub

Sub StopCANoe()
    If canoeApp.Measurement.Running Then
        canoeApp.Measurement.Stop
    End If
    canoeApp.Quit
    Set canoeApp = Nothing
End Sub


CAPL

// 1) Define a System Variable namespace/variable (you can also set this up
//    in the GUI - see CANoe’s System Variables dialog)
on start {
  SysDefineNamespace("General");
  SysDefineVariableInt("General", "PreviousReading", 0);
}

// 2) Regularly sample your signal & update the SysVar
variables {
  msTimer sampleTimer;
  int     currentReading;
}

on start {
  setTimer(sampleTimer, 1000);       // e.g. sample every second
}

on timer sampleTimer {
  currentReading = GetMyTestReading();  // your custom function
  SysSetVariableInt("General", "PreviousReading", currentReading);
  setTimer(sampleTimer, 1000);
}

// 3) Expose a callable reset function
program callable {
  // ResetCounter will be callable via COM
  void ResetCounter() {
    // (Excel will have already logged the old reading)
    currentReading = 0;
    // Optionally update the SysVar immediately, too
    SysSetVariableInt("General", "PreviousReading", currentReading);
  }
}
